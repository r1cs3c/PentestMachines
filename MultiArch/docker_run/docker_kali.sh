#!/bin/bash

# Variables
machine_name="kali_MacOs"
ram_mem="4G"
image="r1cs3c/kali_build:latest"
dir_to_share="$(PWD)"

# Function to print help menu
print_help() {
    echo "Usage: ./script.sh [option]"
    echo "Options:"
    echo "  --no-vpn : Run Docker without VPN support"
    echo "  --amd64  : Run Docker with amd64 image"
    echo "  --vpn    : Run Docker with VPN support"
}

# Check if an option is provided
if [ $# -ne 1 ]; then
    echo "Error: Invalid number of arguments"
    print_help
    exit 1
fi

# Run the appropriate command based on the option
case $1 in
    --no-vpn)
        docker run -d --name $machine_name -h "kali.test" --memory $ram_mem -v "/tmp/":/src/temp/ -v $dir_to_share:/src/home -p 2222:22 -p 3391:3390 -ti $image bash -c "service xrdp restart; /bin/zsh; service ssh start"
        ;;
    --amd64)
        docker run -d --platform linux/amd64 --name $machine_name -h "kali.test" --memory $ram_mem -v "/tmp/":/src/temp/ -v $dir_to_share:/src/home -p 2222:22 -p 3391:3390 -ti $image bash -c "service xrdp restart; /bin/zsh; service ssh start"
        ;;
    --vpn)
        docker run -d --name $machine_name -h "kali.test" --privileged --cap-add=NET_ADMIN --sysctl net.ipv6.conf.all.disable_ipv6=0 --memory $ram_mem -v "/tmp/":/src/temp/ -v "/Users/rcampo/OneDrive - Cochlear Ltd/opt":/opt/ -v "/Users/rcampo/BurpFiles":/src/BurpFiles -v "/Users/rcampo/WorkingDir":/src/WorkingDir -p 3391:3390 -ti $image bash -c "service xrdp restart; /bin/bash"
        ;;
    --vpn-amd64)
        docker run -d --platform linux/amd64 --name $machine_name -h "kali.test" --privileged --cap-add=NET_ADMIN --sysctl net.ipv6.conf.all.disable_ipv6=0 --memory $ram_mem -v "/tmp/":/src/temp/ -v "/Users/rcampo/OneDrive - Cochlear Ltd/opt":/opt/ -v "/Users/rcampo/BurpFiles":/src/BurpFiles -v "/Users/rcampo/WorkingDir":/src/WorkingDir -p 3391:3390 -ti $image bash -c "service xrdp restart; /bin/bash"
        ;;
    *)
        echo "Error: Unknown option '$1'"
        print_help
        ;;
esac
